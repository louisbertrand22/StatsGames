name: "Feature: Implement NFC Sharing (Profile)"
description: "Add NFC-based profile sharing so users can tap phones to exchange a temporary profile token and view public stats."
title: "[Feature] ImplÃ©menter le partage de profil via NFC"
labels: ["feature", "nfc", "mobile", "backend"]
assignees: []

body:
  - type: markdown
    attributes:
      value: |
        ## ðŸŽ¯ Objectif
        ImplÃ©menter le partage de profil **via NFC** : quand un utilisateur active le partage et approche son tÃ©lÃ©phone dâ€™un autre appareil, l'app Ã©crit une URL NDEF contenant un token temporaire. Le smartphone rÃ©cepteur ouvre cette URL (ou la lit dans-app) et affiche le profil public + stats de l'utilisateur Ã©metteur.

        Ce ticket couvre : backend (table & endpoints), mobile (Ã©criture NFC + lecture), page frontend `/nfc/[token]`, et sÃ©curitÃ© (RLS & TTL).

  - type: textarea
    id: context
    attributes:
      label: "ðŸ“š Contexte technique"
      description: "Rappelle les points importants pour l'implÃ©mentation (Supabase, stack mobile, contraintes)."
      placeholder: |
        Exemple :
        - Backend: Supabase (Postgres + RLS)
        - Mobile: React Native (react-native-nfc-manager) ou Flutter (nfc_manager)
        - Token TTL : 15 minutes par dÃ©faut
    validations:
      required: true

  - type: textarea
    id: tasks
    attributes:
      label: "ðŸ› ï¸ TÃ¢ches principales (dÃ©crire l'implÃ©mentation Ã©tape par Ã©tape)"
      description: "DÃ©taille les sous-tÃ¢ches techniques Ã  accomplir."
      placeholder: |
        Exemple de checklist (Ã©crire chaque tÃ¢che sur une ligne) :
        - CrÃ©er table `nfc_shares` en DB
        - Ajouter RLS policies (public read sur token actif)
        - Endpoint POST /nfc/create-token
        - Endpoint GET /nfc/:token (ou page SSR /nfc/[token])
        - ImplÃ©menter writer NFC (NDEF) cÃ´tÃ© mobile
        - ImplÃ©menter reader NFC cÃ´tÃ© mobile / fallback pour open URL
        - UI: Ã©cran "Partager via NFC" + indicateur TTL
        - Tests e2e (tap device A -> device B affiche profil)
    validations:
      required: true

  - type: input
    id: ttl_minutes
    attributes:
      label: "â±ï¸ TTL par dÃ©faut pour les tokens (minutes)"
      description: "DurÃ©e de validitÃ© par dÃ©faut d'un token NFC (ex: 15)"
      placeholder: "15"
    validations:
      required: true

  - type: textarea
    id: api_contract
    attributes:
      label: "ðŸ”— Contrat API attendu (exemples de requÃªtes / rÃ©ponses)"
      description: "DÃ©cris les endpoints, payloads et rÃ©ponses attendues."
      placeholder: |
        Exemple :
        POST /nfc/create-token
        body: { user_id: auth.uid() }
        response: { token: "abc123", url: "https://statsgames.app/nfc/abc123", expires_at: "..." }

        GET /nfc/:token
        response: { user: { id, username, avatar_url }, stats: {...} }
    validations:
      required: true

  - type: textarea
    id: mobile_notes
    attributes:
      label: "ðŸ“± Notes / recommandations mobile"
      description: "Libs, NDEF format, permissions, fallback behavior."
      placeholder: |
        Exemple :
        - React Native : use react-native-nfc-manager
        - Format NDEF : URI record with https://statsgames.app/nfc/{token}
        - Sur iOS : utiliser CoreNFC / vÃ©rifier entitlements
        - Fallback : si NFC non supportÃ©, copier token dans le presse-papier
    validations:
      required: true

  - type: dropdown
    id: security_visibility
    attributes:
      label: "ðŸ” VisibilitÃ© du profil partagÃ© via token"
      description: "Choisir quelles donnÃ©es sont visibles via le token NFC."
      options:
        - pseudonyme + avatar + stats publiques (recommended)
        - uniquement pseudonyme + avatar
        - pseudonyme + avatar + stats dÃ©taillÃ©es
      default: 0

  - type: textarea
    id: acceptance
    attributes:
      label: "âœ… CritÃ¨res d'acceptation"
      description: "Liste claire des conditions qui valident la tÃ¢che."
      placeholder: |
        Exemple :
        - Table `nfc_shares` crÃ©Ã©e et migrÃ©e
        - Endpoint POST /nfc/create-token renvoie token + url + expires_at
        - Endpoint GET /nfc/:token retourne profil public si token actif
        - App mobile encode correctement une URI NDEF et la diffuse
        - App mobile rÃ©ceptrice ouvre la page /nfc/:token et affiche le profil
        - Token expire aprÃ¨s TTL et n'est plus accessible
        - Tests manuels : Tap A -> B affiche profil (Android & iOS)
    validations:
      required: true

  - type: textarea
    id: testing
    attributes:
      label: "ðŸ§ª Plan de tests"
      description: "ProcÃ©dure pour QA et tests e2e (devices requis, scÃ©narios)."
      placeholder: |
        Exemple :
        - Test 1: Device A (Android) writer -> Device B (Android) reader
        - Test 2: Device A (iOS) writer -> Device B (Android) reader
        - Test 3: NFC disabled fallback (copier token)
        - Test 4: Token expired access denied
    validations:
      required: true

  - type: textarea
    id: references
    attributes:
      label: "ðŸ”Ž RÃ©fÃ©rences & liens utiles"
      description: "Liens vers docs Supabase, libs NFC, exemples NDEF."
      placeholder: |
        - Supabase policies: https://supabase.com/docs
        - react-native-nfc-manager: https://github.com/whitedogg13/react-native-nfc-manager
        - NDEF URI record spec
    validations:
      required: false
